{"version":3,"sources":["ciber.js"],"names":["console","log","base_url","ready","document","sessionStartTimes","sessionTimers","Audio","$","showAlert","message","text","fadeIn","alertSound","currentTime","play","error","e","actualizarContadores","each","ahora","card","Date","diferencia","floor","horas","Math","inicio","id","tiempoTranscurrido","minutos","find","segundos","finalizarSesion","toString","padStart","playAlertSound","pararA","parseInt","val","iniciarSesion","response","success","removeClass","addClass","clearInterval","prop","fail","eliminarMaquina","confirm","post","setTimeout","location","reload","addEventListener","click","this","closest","data","maquinaId","parar_a","toLocaleTimeString","setInterval","nota","mensaje","submit","preventDefault","nombre","trim"],"mappings":"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","file":"ciber.min.js","sourcesContent":["console.log('Base URL:', base_url);\r\n\r\n$(document).ready(function() {\r\n    var sessionStartTimes = {};\r\n    var sessionTimers = {};\r\n    var alertSound = new Audio(base_url + 'assets/audio/alert_sound.mp3');\r\n\r\n    // Verificar si el audio se carga correctamente\r\n    alertSound.addEventListener('canplaythrough', function() {\r\n        console.log('El sonido se cargó correctamente.');\r\n    });\r\n\r\n    alertSound.addEventListener('error', function(e) {\r\n        console.log('Error al cargar el sonido:', e);\r\n    });\r\n\r\n    console.log('Ruta del sonido:', base_url + 'assets/audio/alert_sound.mp3');\r\n\r\n    function showAlert(message) {\r\n        $('#alert-message').text(message);\r\n        $('#alert-overlay').fadeIn();\r\n    }\r\n\r\n    function playAlertSound() {\r\n        try {\r\n            alertSound.currentTime = 0;\r\n            alertSound.play().then(() => {\r\n                console.log('El sonido se está reproduciendo.');\r\n            }).catch(function(error) {\r\n                console.log('Error al reproducir el audio:', error);\r\n            });\r\n        } catch (e) {\r\n            console.log('Error al intentar reproducir el sonido:', e);\r\n        }\r\n    }\r\n\r\n    // Botón de prueba para reproducir el sonido manualmente\r\n    $('body').append('<button id=\"prueba-sonido\" style=\"position: fixed; bottom: 20px; right: 20px; z-index: 1000;\">Probar Sonido</button>');\r\n    $('#prueba-sonido').click(function() {\r\n        playAlertSound();\r\n    });\r\n\r\n    $('#alert-close').click(function() {\r\n        $('#alert-overlay').fadeOut();\r\n    });\r\n\r\n    function actualizarContadores() {\r\n        $('.card').each(function() {\r\n            var card = $(this);\r\n            var id = card.data('id');\r\n\r\n            if (sessionStartTimes[id]) {\r\n                var ahora = new Date();\r\n                var inicio = sessionStartTimes[id];\r\n                var diferencia = Math.floor((ahora - inicio) / 1000);\r\n\r\n                var horas = Math.floor(diferencia / 3600);\r\n                var minutos = Math.floor((diferencia % 3600) / 60);\r\n                var segundos = diferencia % 60;\r\n\r\n                var tiempoTranscurrido = \r\n                    horas.toString().padStart(2, '0') + ':' +\r\n                    minutos.toString().padStart(2, '0') + ':' +\r\n                    segundos.toString().padStart(2, '0');\r\n\r\n                card.find('.contador').text(tiempoTranscurrido);\r\n\r\n                var pararA = parseInt(card.find('.parar-a').val());\r\n                if (pararA && (minutos >= pararA)) {\r\n                    finalizarSesion(id, card);\r\n                    showAlert('El tiempo ha terminado para la máquina ' + card.find('.card-header h5').text());\r\n                    playAlertSound(); // Sonar la alarma cuando el tiempo ha terminado\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    function iniciarSesion(id, card) {\r\n        var ahora = new Date();\r\n        var pararA = card.find('.parar-a').val();\r\n\r\n        $.post(base_url + 'index.php/Ciber/iniciar_sesion', {id: id, parar_a: pararA}, function(response) {\r\n            if (response.success) {\r\n                card.find('.status-indicator').removeClass('status-inactive').addClass('status-active');\r\n                card.find('.estado').text('en uso');\r\n                card.find('.inicio').text(ahora.toLocaleTimeString());\r\n                sessionStartTimes[id] = ahora;\r\n                card.find('.contador').text('00:00:00');\r\n                sessionTimers[id] = setInterval(function() { actualizarContadores(); }, 1000);\r\n                card.find('.iniciar').prop('disabled', true);\r\n                card.find('.finalizar').prop('disabled', false);\r\n            } else {\r\n                showAlert('Error al iniciar sesión.');\r\n            }\r\n        }, 'json').fail(function() {\r\n            showAlert('Error de comunicación con el servidor.');\r\n        });\r\n    }\r\n\r\n    function finalizarSesion(id, card) {\r\n        $.post(base_url + 'index.php/Ciber/finalizar_sesion', {id: id}, function(response) {\r\n            if (response.success) {\r\n                card.find('.status-indicator').removeClass('status-active').addClass('status-inactive');\r\n                card.find('.estado').text('sin usar');\r\n                card.find('.inicio').text('');\r\n                card.find('.contador').text('00:00:00');\r\n                card.find('.nota').val('');\r\n                clearInterval(sessionTimers[id]);\r\n                delete sessionStartTimes[id];\r\n                delete sessionTimers[id];\r\n                card.find('.iniciar').prop('disabled', false);\r\n                card.find('.finalizar').prop('disabled', true);\r\n            } else {\r\n                showAlert('Error al finalizar sesión.');\r\n            }\r\n        }, 'json').fail(function() {\r\n            showAlert('Error de comunicación con el servidor.');\r\n        });\r\n    }\r\n\r\n    // Función para eliminar una máquina\r\n    function eliminarMaquina(id) {\r\n        if (confirm('¿Está seguro de que desea eliminar esta máquina?')) {\r\n            playAlertSound(); // Sonar la alarma al confirmar la eliminación\r\n            $.post(base_url + 'index.php/Ciber/eliminar_maquina', {id: id}, function(response) {\r\n                console.log('Respuesta del servidor:', response); // Verificar la respuesta del servidor\r\n                if (response.success) {\r\n                    showAlert('Máquina eliminada correctamente.');\r\n                    setTimeout(function() { // Agregar un retraso antes de recargar la página\r\n                        location.reload();\r\n                    }, 1000); // Retraso de 1 segundo para permitir que la alarma se reproduzca\r\n                } else {\r\n                    showAlert('Error al eliminar la máquina.');\r\n                }\r\n            }, 'json').fail(function() {\r\n                showAlert('Error de comunicación con el servidor.');\r\n            });\r\n        }\r\n    }\r\n\r\n    // Evento para el botón \"Eliminar\" de cada tarjeta\r\n    $('.eliminar').click(function() {\r\n        var card = $(this).closest('.card');\r\n        var id = card.data('id');\r\n        eliminarMaquina(id);\r\n    });\r\n\r\n    // Nuevo código para eliminar máquina desde la barra lateral\r\n    $('#eliminar-maquina-btn').click(function() {\r\n        var maquinaId = $('#maquina-a-eliminar').val();\r\n    \r\n        if (!maquinaId) {\r\n            showAlert('Por favor, seleccione una máquina para eliminar.');\r\n            return;\r\n        }\r\n\r\n        eliminarMaquina(maquinaId);\r\n    });\r\n\r\n    $('.iniciar').click(function() {\r\n        var card = $(this).closest('.card');\r\n        var id = card.data('id');\r\n        iniciarSesion(id, card);\r\n    });\r\n\r\n    $('.finalizar').click(function() {\r\n        var card = $(this).closest('.card');\r\n        var id = card.data('id');\r\n        finalizarSesion(id, card);\r\n    });\r\n\r\n    $('.enviar-mensaje').click(function() {\r\n        var card = $(this).closest('.card');\r\n        var id = card.data('id');\r\n        var nota = card.find('.nota').val();\r\n        var mensaje = card.find('.mensaje').val();\r\n        \r\n        $.post(base_url + 'index.php/Ciber/actualizar_nota_mensaje', {id: id, nota: nota, mensaje: mensaje}, function(response) {\r\n            if (response.success) {\r\n                showAlert('Mensaje enviado correctamente.');\r\n                card.find('.mensaje').val('');\r\n            } else {\r\n                showAlert('Error al actualizar nota y mensaje.');\r\n            }\r\n        }, 'json').fail(function() {\r\n            showAlert('Error de comunicación con el servidor.');\r\n        });\r\n    });\r\n\r\n    $('#agregar-maquina-form').submit(function(e) {\r\n        e.preventDefault();\r\n        var nombre = $('#nombre-maquina').val();\r\n\r\n        $.post(base_url + 'index.php/Ciber/agregar_maquina', {nombre: nombre}, function(response) {\r\n            if (response.success) {\r\n                showAlert('Máquina agregada correctamente.');\r\n                location.reload();\r\n            } else {\r\n                showAlert('Error al agregar la máquina.');\r\n            }\r\n        }, 'json').fail(function() {\r\n            showAlert('Error de comunicación con el servidor.');\r\n        });\r\n    });\r\n\r\n    // Inicializar el estado de los botones\r\n    $('.card').each(function() {\r\n        var card = $(this);\r\n        if (card.find('.estado').text().trim() === 'en uso') {\r\n            card.find('.iniciar').prop('disabled', true);\r\n            card.find('.finalizar').prop('disabled', false);\r\n            var inicio = new Date(card.find('.inicio').text());\r\n            sessionStartTimes[id] = inicio;\r\n            sessionTimers[id] = setInterval(function() { actualizarContadores(); }, 1000);\r\n        } else {\r\n            card.find('.iniciar').prop('disabled', false);\r\n            card.find('.finalizar').prop('disabled', true);\r\n        }\r\n    });\r\n\r\n    // Iniciar los contadores para las sesiones en curso\r\n    actualizarContadores();\r\n    setInterval(actualizarContadores, 1000);\r\n});\r\n\r\n"]}